# apiVersion: argoproj.io/v1alpha1
# kind: Pipeline
# metadata:
#   name: atlantis-deploy-pipeline
# spec:
#   stages:
#   - name: deploy
#     steps:
#     - name: helm-deploy
#       helm:
#         chart: runatlantis/atlantis
#         repository:
#           url: https://runatlantis.github.io/helm-charts
#         values:
#           github:
#              user: {{ .secret.atlantis-credentials.github-user }}
#             token: {{ .secret.atlantis-credentials.github-token }}
#             secret: {{ .secret.atlantis-credentials.github-secret }}
#        releaseName: atlantis
#         targetNamespace: default

---
project: default
source:
  repoURL: 'https://runatlantis.github.io/helm-charts'
  targetRevision: 4.25.0
  helm:
    values: |-
      github:
        user: {{ configMap "atlantis-credentials" "github-user" }}
        token: {{ configMap "atlantis-credentials" "github-token" }}
        secret: {{ configMap "atlantis-credentials" "github-secret" }}
  chart: atlantis
destination:
  server: 'https://kubernetes.default.svc'
  namespace: default
syncPolicy:
  automated:
    prune: true
    selfHeal: true
  syncOptions:
    - CreateNamespace=true
